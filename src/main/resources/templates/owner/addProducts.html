<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Add New Course</title>
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="noindex" />
<!-- Price Slider Stylesheets -->
<link rel="stylesheet"
	href="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/nouislider/nouislider.css" />
<!-- Google fonts - Playfair Display -->
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700" />
<link rel="stylesheet" href="fonts/hkgrotesk/stylesheet.2e9c9834.css" />
<!-- Owl carousel -->
<link rel="stylesheet"
	href="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/owl.carousel/assets/owl.carousel.css" />
<!-- Lightbox -->
<link rel="stylesheet"
	href="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/glightbox/css/glightbox.min.css" />
<!-- Theme stylesheet -->
<link rel="stylesheet"
	href="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/css/style.default.7acfaf01.css"
	id="theme-stylesheet" />
<!-- Custom stylesheet - for your changes -->
<link rel="stylesheet"
	href="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/css/custom.0a822280.css" />
<!-- Font Awesome -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- Bootstrap 5 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<style>
body {
	font-family: "Poppins", sans-serif;
	background-color: #f5f7fa;
}

/* Ensure custom-sidebar applies to imported fragments */
.custom-sidebar {
	/* This class is used as a namespace for sidebar and header styles */
	
}

/* Main Content */
.main-content {
	margin-left: 280px;
	padding: 20px;
}

/* Course Header */
.main-content .course-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20px;
}

.main-content .course-header h2 {
	font-size: 24px;
	font-weight: 600;
	color: #343a40;
}

.main-content .course-header .btn-link {
	background-color: #f8f9fa;
	color: #2c7ec4;
	text-decoration: none;
	font-size: 16px;
	padding: 8px 16px;
	border: 1px solid #3494e6;
	border-radius: 5px;
}

.main-content .course-header .btn-link:hover {
	background-color: #3494e6;
	color: #fff;
}

/* Breadcrumb */
.main-content .breadcrumb {
	margin-bottom: 20px;
}

.main-content .breadcrumb-item a {
	color: #3494e6;
	text-decoration: none;
}

.main-content .breadcrumb-item a:hover {
	text-decoration: underline;
}

/* Form Sections */
.main-content .form-section {
	background-color: #fff;
	border-radius: 10px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
	padding: 20px;
	margin-bottom: 20px;
}

.main-content .form-section h5 {
	font-size: 18px;
	font-weight: 600;
	color: #343a40;
	margin-bottom: 20px;
}

.main-content .form-section .form-group {
	margin-bottom: 15px;
}

.main-content .form-section .form-group label {
	font-weight: 500;
	color: #343a40;
	margin-bottom: 5px;
}

.main-content .form-section .form-control, .main-content .form-section .form-select
	{
	border-radius: 5px;
	border: 1px solid #ced4da;
	padding: 8px;
	font-size: 14px;
}

.main-content .form-section .form-control:focus, .main-content .form-section .form-select:focus
	{
	border-color: #3494e6;
	box-shadow: 0 0 5px rgba(52, 148, 230, 0.2);
}

/* Image Upload */
.main-content .image-upload {
	border: 2px dashed #ced4da;
	border-radius: 10px;
	height: 150px;
	display: flex;
	align-items: center;
	justify-content: center;
	color: #6c757d;
	font-size: 14px;
	background-color: #f8f9fa;
}

/* Two Columns Layout */
.main-content .form-two-columns {
	display: flex;
	flex-wrap: wrap;
	gap: 20px;
}

.main-content .form-two-columns .col {
	flex: 1;
	min-width: 300px;
}

/* Status Radio Buttons */
.main-content .status-radio label {
	margin-right: 20px;
	font-size: 14px;
	color: #343a40;
}

/* Submit Button */
.main-content .submit-section {
	text-align: right;
}

.main-content .submit-section .btn-primary {
	background-color: #3494e6;
	border-color: #3494e6;
}

.main-content .submit-section .btn-primary:hover {
	background-color: #2c7ec4;
	border-color: #2c7ec4;
}

/* Image Input Options */
.main-content .image-options {
	display: flex;
	align-items: center;
	gap: 10px;
	margin-bottom: 10px;
}

.main-content .image-options input[type="radio"] {
	margin-right: 5px;
}
</style>
</head>
<body>
	<!-- Sidebar -->
	<div class="custom-sidebar">
		<div th:replace="~{owner/sidebar :: sidebar}"></div>
	</div>

	<!-- Main Content -->
	<div class="main-content">
		<!-- Header -->
		<div class="custom-sidebar">
			<div th:replace="~{owner/sidebar :: header}"></div>
		</div>

		<!-- Course Header -->
		<div class="course-header">
			<h2>Add New Course</h2>
			<a th:href="@{/owner/productsList}" class="btn btn-link">Back to Courses List</a>
		</div>

		<!-- Breadcrumb -->
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><i class="fas fa-home px-2"></i><a
				href="/dashboard">Dashboard</a></li>
			<li class="breadcrumb-item"><a th:href="@{/owner/productsList}">Courses</a></li>
			<li class="breadcrumb-item active">Add Course</li>
		</ol>

		<!-- Form -->
		<form id="addCourseForm" enctype="multipart/form-data">
			<!-- Course Information -->
			<div class="form-section">
				<h5>Course Information</h5>
				<div class="form-two-columns">
					<div class="col">
						<div class="form-group">
							<label for="title">Title</label>
							<input type="text" class="form-control" id="title" name="title" placeholder="Enter Course Title" required />
						</div>
						<div class="form-group">
							<label for="description">Description</label>
							<textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter Course Description" required></textarea>
						</div>
						<div class="form-group">
							<label for="prices">Price</label>
							<input type="number" step="0.01" class="form-control" id="prices" name="prices" placeholder="Enter Course Price" required />
						</div>
					</div>
					<div class="col">
						<div class="form-group">
							<label for="categoryID">Course Category</label>
							<select class="form-select" id="categoryID" name="categoryID" required>
								<option value="" disabled selected>Select Category</option>
							</select>
						</div>
						<div class="form-group">
							<label>Status</label>
							<div class="status-radio">
								<input type="radio" id="statusActive" name="status" value="ACTIVE" checked />
								<label for="statusActive">Active</label>
								<input type="radio" id="statusInactive" name="status" value="INACTIVE" />
								<label for="statusInactive">Inactive</label>
							</div>
						</div>
						<div class="form-group">
							<label for="quantity">Quantity</label>
							<input type="number" min="0" class="form-control" id="quantity" name="quantity" placeholder="Enter Quantity" required />
						</div>
						<div class="form-group">
							<label for="duration">Duration</label>
							<input type="date" class="form-control" id="duration" name="duration" />
						</div>
					</div>
				</div>
			</div>

			<!-- Course Images -->
			<div class="form-section">
				<h5>Course Image</h5>
				<div class="form-group">
					<label for="imageUrlInput">Image URL</label>
					<input type="text" class="form-control" id="imageUrlInput" name="imageUrl" placeholder="Enter Image URL" required />
				</div>
			</div>

			<!-- Submit Button -->
			<div class="submit-section">
				<button type="submit" class="btn btn-primary">Add Course</button>
			</div>
		</form>
	</div>

	<!-- JavaScript files -->
	<script>
		function injectSvgSprite(path) {
			var ajax = new XMLHttpRequest();
			ajax.open("GET", path, true);
			ajax.send();
			ajax.onload = function(e) {
				var div = document.createElement("div");
				div.className = "d-none";
				div.innerHTML = ajax.responseText;
				document.body.insertBefore(div, document.body.childNodes[0]);
			};
		}
		injectSvgSprite("https://demo.bootstrapious.com/sell/1-2-0/icons/orion-svg-sprite.svg");
	</script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/jquery/jquery.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/owl.carousel/owl.carousel.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/owl.carousel2.thumbs/owl.carousel2.thumbs.min.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/nouislider/nouislider.min.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/smooth-scroll/smooth-scroll.polyfills.min.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/glightbox/js/glightbox.min.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/object-fit-images/ofi.min.js"></script>
	<script>
		var basePath = "";
	</script>
	<script src="js/theme.30e7c8f9.js"></script>
	<script
		src="https://d19m59y37dris4.cloudfront.net/sell/2-0-1/vendor/jquery.cookie/jquery.cookie.js"></script>
	<script src="js/demo.9833433a.js"></script>

	<script>
		if (typeof bootstrap === 'undefined') {
			console.error("Bootstrap JavaScript is not loaded.");
		}

		document.addEventListener("DOMContentLoaded", function () {
			// Load categories
			function loadCategories() {
				const token = localStorage.getItem("jwtToken");
				if (!token) {
					alert("Please log in again!");
					window.location.href = "/login";
					return;
				}

				fetch("/owner/categories", {
					method: "GET",
					headers: {
						"Content-Type": "application/json",
						"Authorization": "Bearer " + token
					}
				})
						.then(response => {
							if (!response.ok) {
								return response.text().then(text => {
									throw new Error(`HTTP ${response.status}: ${text}`);
								});
							}
							return response.json();
						})
						.then(categories => {
							const categorySelect = document.getElementById("categoryID");
							categorySelect.innerHTML = '<option value="" disabled selected>Select Category</option>';
							categories.forEach(category => {
								const option = document.createElement("option");
								option.value = category.categoryID;
								option.textContent = category.categoryName;
								categorySelect.appendChild(option);
							});
						})
						.catch(error => {
							console.error("Error loading categories:", error);
							alert("Unable to load categories: " + error.message);
						});
			}

			loadCategories();

			// Handle form submission
			document.getElementById("addCourseForm").addEventListener("submit", function (e) {
				e.preventDefault();

				const title = document.getElementById("title").value;
				const description = document.getElementById("description").value;
				const prices = document.getElementById("prices").value;
				const status = document.querySelector("input[name='status']:checked").value;
				const quantity = document.getElementById("quantity").value;
				const categoryID = document.getElementById("categoryID").value;
				const duration = document.getElementById("duration").value;
				const imageUrl = document.getElementById("imageUrlInput").value;

				// Validate inputs
				if (!title.trim()) {
					alert("Please enter a title!");
					return;
				}
				if (!prices || prices < 0) {
					alert("Please enter a valid price (non-negative)!");
					return;
				}
				if (!quantity || quantity < 0) {
					alert("Please enter a valid quantity (non-negative)!");
					return;
				}
				if (!categoryID) {
					alert("Please select a category!");
					return;
				}
				if (!imageUrl.trim()) {
					alert("Please enter an image URL!");
					return;
				}

				const formData = new FormData();
				formData.append("title", title);
				formData.append("description", description);
				formData.append("prices", prices);
				formData.append("status", status);
				formData.append("quantity", quantity);
				formData.append("categoryID", categoryID);
				formData.append("imageUrl", imageUrl);
				if (duration) {
					formData.append("duration", duration);
				}

				const token = localStorage.getItem("jwtToken");
				if (!token) {
					alert("Please log in again!");
					window.location.href = "/login";
					return;
				}

				console.log("Sending form data:", formData);

				fetch("/owner/course/add", {
					method: "POST",
					headers: {
						"Authorization": "Bearer " + token
					},
					body: formData
				})
						.then(response => {
							if (!response.ok) {
								return response.text().then(text => {
									throw new Error(`HTTP ${response.status}: ${text}`);
								});
							}
							return response.text();
						})
						.then(data => {
							alert("Course added successfully!");
							window.location.href = "/owner/productsList";
						})
						.catch(error => {
							console.error("Error:", error.message);
							alert("An error occurred: " + error.message);
						});
			});
		});
	</script>

</body>
</html>