<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>

<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>Online Course</title>

<!-- Google fonts-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Martel+Sans:wght@300;400;800&display=swap" rel="stylesheet">

<!-- CSS files -->
<link rel="stylesheet"
	th:href="@{/vendor/bootstrap/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/fontawesome.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/style.default.7acfaf01.css}">
<link rel="stylesheet" th:href="@{/assets/css/custom.0a822280.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/templatemo-space-dynamic.css}">

</head>

<body>
	<!-- SVG Sprite -->
	<div th:insert="~{fragments/svg-sprite :: svg-sprite}"></div>

	<!-- ***** Preloader Start ***** -->
	<div id="js-preloader" class="js-preloader">
		<div class="preloader-inner">
			<span class="dot"></span>
			<div class="dots">
				<span></span> <span></span> <span></span>
			</div>
		</div>
	</div>
	<!-- ***** Preloader End ***** -->

	<!-- ***** Header Area Start ***** -->
	<!-- <div th:insert="~{decorators/headers :: header}"></div> -->
	<!-- ***** Header Area End ***** -->

	<section class="hero pt-1">
		<div class="container-fluid">
			<div class="row d-flex justify-content-center align-items-center">
				<div class="col-xl-5 col-lg-6 col-md-7 d-none d-md-block">
					<div class="left-image wow fadeInLeft" data-wow-duration="1s"
						data-wow-delay="0.3s">
						<img
							th:src="@{https://img.freepik.com/free-vector/mobile-login-concept-illustration_114360-83.jpg?w=2000}"
							alt="login illustration" class="img-fluid"
							>
					</div>
				</div>
				<div class="col-xl-5 col-lg-7 col-md-8">
					<div class="product shadow-custom">
						<div class="px-4 py-4 text-black">
							<form th:action="@{/api/auth/login}" method="post" id="loginForm">
								<div class="text-center mb-3">
									<div
										class="d-flex align-items-center justify-content-center mb-3">
										<i class="fa fa-user fa-2x me-3 text-color-custom"></i>
										<h3 class="h4 text-uppercase mb-0">Xin chào</h3>
									</div>
									<h5 class="text-muted text-sm">Đăng nhập vào tài khoản của
										bạn</h5>
								</div>

								<!-- Thông báo lỗi -->
								<div th:if="${param.error}" class="alert alert-danger">
									Email/phone hoặc mật khẩu không đúng
								</div>
								<div th:if="${param.logout}" class="alert alert-success">
									Bạn đã đăng xuất thành công
								</div>

								<!-- Form inputs -->
								<div class="form-outline mb-3">
									<label class="form-label" for="emailOrPhone">Email hoặc Số
										điện thoại</label> <input type="text" id="emailOrPhone" name="emailOrPhone"
										class="form-control border-radius-custom" required />
								</div>

								<div class="form-outline mb-3">
									<label class="form-label" for="password">Mật khẩu</label> <input
										type="password" id="password" name="password"
										class="form-control border-radius-custom" required />
								</div>

								<div class="mb-3">
									<button class="btn btn-cart28tech w-100 py-3 border-radius-custom" type="submit">
										Đăng nhập</button>
								</div>

								<div class="text-center mb-3">
									<a class="text-muted small" th:href="@{/forgot-password}">
										Quên mật khẩu? </a>
									<p class="text-muted mt-3 mb-0">
										Bạn chưa có tài khoản? <a th:href="@{/register}"
											class="text-color-custom text-decoration-none"> Đăng ký
											tại đây </a>
									</p>
								</div>

								<div class="text-center mb-4">
									<hr class="my-4">
									<span class="text-muted small">Hoặc đăng nhập với</span>
								</div>

								<div class="text-center">
									<a
										href="https://accounts.google.com/o/oauth2/auth?scope=email profile openid
	                                    &redirect_uri=http://localhost:8088/FashionWebsite/login
	                                    &response_type=code
	                                    &client_id=92430984248-0r7mhi86oi7nlno71ak4a5eseol715vv.apps.googleusercontent.com
	                                    &approval_prompt=force"
										class="btn btn-detail28tech w-100 py-3 border-radius-custom"> <i
										class="bi bi-google me-2 "></i> Đăng nhập với Google
									</a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- ***** Footer Area Start ***** -->
	<!-- <div th:insert="~{decorators/footers :: footer}"></div> 
	<!-- ***** Footer Area End ***** -->


	<!-- Scripts -->
	<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
	<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/js/wow.min.js}"></script>
	<script th:src="@{/assets/js/owl-carousel.js}"></script>
	<script th:src="@{/assets/js/animation.js}"></script>
	<script th:src="@{/assets/js/imagesloaded.js}"></script>
	<script th:src="@{/assets/js/custom.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script>
		// Xử lý preloader
		$(window).on('load', function() {
			$('#js-preloader').addClass('loaded');
			setTimeout(function() {
				$('#js-preloader').fadeOut('slow');
			}, 500);
		});

		$(document).ready(function() {
			$('#loginForm').on('submit', function(e) {
				e.preventDefault();
				
				$.ajax({
					url: '/api/auth/login',
					type: 'POST',
					data: {
						emailOrPhone: $('#emailOrPhone').val(),
						password: $('#password').val()
					},
					success: function(response) {
						// Parse phản hồi JSON
						let data = typeof response === 'string' ? JSON.parse(response) : response;

						if (data.status === 'success') {
							Swal.fire({
								title: 'Thành công!',
								text: data.message,
								icon: 'success',
								confirmButtonText: 'OK'
							}).then((result) => {
								if (result.isConfirmed) {
									window.location.replace('/');
								}
							});
						} else if (data.status === 'error') {
							Swal.fire({
								title: 'Lỗi!',
								text: data.message,
								icon: 'error',
								confirmButtonText: 'OK'
							});
						}
					},
					error: function(xhr) {
						let errorMessage = 'Đã xảy ra lỗi khi đăng nhập';
						try {
							let data = JSON.parse(xhr.responseText);
							if (data.status === 'error') {
								errorMessage = data.message;
							}
						} catch (e) {
							errorMessage = xhr.responseText || errorMessage;
						}
						Swal.fire({
							title: 'Lỗi!',
							text: errorMessage,
							icon: 'error',
							confirmButtonText: 'OK'
						});
					},
					error: function(xhr) {
						let errorMessage = 'Đã xảy ra lỗi khi đăng nhập';
						if (xhr.responseText && xhr.responseText.startsWith('error:')) {
							errorMessage = xhr.responseText.substring(6);
						}
						Swal.fire({
							title: 'Lỗi!',
							text: errorMessage,
							icon: 'error',
							confirmButtonText: 'OK'
						});
					}
				});
			});

			function handleLogout() {
				$.ajax({
					url: '/api/auth/logout',
					type: 'POST',
					success: function(response) {
						if (response.startsWith('success:')) {
							Swal.fire({
								title: 'Thành công!',
								text: response.substring(8),
								icon: 'success',
								confirmButtonText: 'OK'
							}).then((result) => {
								if (result.isConfirmed) {
									window.location.replace('/login');
								}
							});
						} else if (response.startsWith('error:')) {
							Swal.fire({
								title: 'Lỗi!',
								text: response.substring(6),
								icon: 'error',
								confirmButtonText: 'OK'
							});
						} else {
							Swal.fire({
								title: 'Thành công!',
								text: 'Bạn đã đăng xuất thành công!',
								icon: 'success',
								confirmButtonText: 'OK'
							}).then((result) => {
								if (result.isConfirmed) {
									window.location.replace('/login');
								}
							});
						}
					},
					error: function(xhr) {
						let errorMessage = 'Đã xảy ra lỗi khi đăng xuất';
						if (xhr.responseText && xhr.responseText.startsWith('error:')) {
							errorMessage = xhr.responseText.substring(6);
						}
						Swal.fire({
							title: 'Lỗi!',
							text: errorMessage,
							icon: 'error',
							confirmButtonText: 'OK'
						});
					}
				});
			}
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.has('logout')) {
				handleLogout();
			}
		});
	</script>
</body>
</html>
